subject: namespace:ns
revision: "2022"
rules:
        #- selector: service.name == “*”
        #- selector: service.name == "myservice"
- selector: source.name == "test"
  aspects:
  - kind: metrics
    adapter: prometheus
    params:
      metrics:
      - descriptorName: request_count
        # we want to increment this counter by 1 for each unique (source, target, service, method, response_code) tuple
        value: response.latency | 100
        labels:
          source: source.name | "one"
          target: target.name | "one"
          service: api.name | "one"
          method: api.method | "one"
          response_code: response.http.code | 111
      - descriptorName:  request_latency
        value: response.latency | 200
        labels:
          source: source.name | "two"
          target: target.name | "two"
          service: api.name | "two"
          method: api.method | "two"
          response_code: response.http.code | 222
- selector: source.name == "foo"
  aspects:
  - kind: metrics
    adapter: prometheus
    params:
      metrics:
      - descriptorName:  request_latency
        value: response.latency | 300
        labels:
          source: source.name | "three"
          target: target.name | "three"
          service: api.name | "three"
          method: api.method | "three"
          response_code: response.http.code | 333
  - kind: metrics
    adapter: prometheus
    params:
      metrics:
      - descriptorName: request_count
        # we want to increment this counter by 1 for each unique (source, target, service, method, response_code) tuple
        value: "400"
        labels:
          source: source.name | "four"
          target: target.name | "four"
          service: api.name | "four"
          method: api.method | "four"
          response_code: response.http.code | 444
